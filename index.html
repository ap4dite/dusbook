<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Meeting Room Booking</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Sarabun', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #e0f2fe 0%, #f1f8e9 100%); }
        .card-shadow { box-shadow: 0 4px 20px rgba(0, 150, 136, 0.1); }
        .btn-primary { background: linear-gradient(135deg, #00bcd4 0%, #26a69a 100%); }
        .btn-primary:hover { background: linear-gradient(135deg, #00acc1 0%, #00897b 100%); }
        .loading { opacity: 0.6; pointer-events: none; }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div class="container mx-auto px-4 py-6">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-teal-800 mb-2">üè¢ Smart Meeting Room Booking</h1>
            <p class="text-xl text-teal-600">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</p>
            <div id="connection-status" class="mt-2">
                <span class="text-sm text-green-600">üü¢ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</span>
            </div>
        </div>

        <!-- Navigation -->
        <div class="flex justify-center mb-8">
            <div class="bg-white rounded-full p-2 card-shadow">
                <button onclick="showPage('booking')" id="nav-booking" class="px-6 py-2 rounded-full btn-primary text-white font-medium">‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</button>
                <button onclick="showPage('mybookings')" id="nav-mybookings" class="px-6 py-2 rounded-full text-teal-700 hover:bg-teal-50 font-medium">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</button>
                <button onclick="showPage('statistics')" id="nav-statistics" class="px-6 py-2 rounded-full text-teal-700 hover:bg-teal-50 font-medium">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</button>
            </div>
        </div>

        <!-- Booking Page -->
        <div id="booking-page" class="page">
            <div class="grid lg:grid-cols-2 gap-8">
                <!-- Calendar Section -->
                <div class="bg-white rounded-2xl p-6 card-shadow">
                    <h2 class="text-2xl font-semibold text-teal-800 mb-4">üìÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</h2>
                    <div class="mb-4">
                        <input type="date" id="selected-date" class="w-full p-3 border-2 border-teal-200 rounded-lg focus:border-teal-500 focus:outline-none">
                    </div>
                    
                    <!-- Time Selection -->
                    <h3 class="text-xl font-semibold text-teal-800 mb-3">‚è∞ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤</h3>
                    <div class="grid grid-cols-2 gap-3 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-teal-700 mb-1">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</label>
                            <select id="start-time" class="w-full p-2 border-2 border-teal-200 rounded-lg focus:border-teal-500 focus:outline-none">
                                <option value="08:00">08:00</option>
                                <option value="09:00">09:00</option>
                                <option value="10:00">10:00</option>
                                <option value="11:00">11:00</option>
                                <option value="12:00">12:00</option>
                                <option value="13:00">13:00</option>
                                <option value="14:00">14:00</option>
                                <option value="15:00">15:00</option>
                                <option value="16:00">16:00</option>
                                <option value="17:00">17:00</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-teal-700 mb-1">‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label>
                            <select id="end-time" class="w-full p-2 border-2 border-teal-200 rounded-lg focus:border-teal-500 focus:outline-none">
                                <option value="09:00">09:00</option>
                                <option value="10:00">10:00</option>
                                <option value="11:00">11:00</option>
                                <option value="12:00">12:00</option>
                                <option value="13:00">13:00</option>
                                <option value="14:00">14:00</option>
                                <option value="15:00">15:00</option>
                                <option value="16:00">16:00</option>
                                <option value="17:00">17:00</option>
                                <option value="18:00">18:00</option>
                            </select>
                        </div>
                    </div>
                    <button onclick="checkAvailability()" class="w-full btn-primary text-white py-3 rounded-lg font-medium hover:shadow-lg transition-all">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á</button>
                </div>

                <!-- Room List Section -->
                <div class="bg-white rounded-2xl p-6 card-shadow">
                    <h2 class="text-2xl font-semibold text-teal-800 mb-4">üèõÔ∏è ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</h2>
                    <div id="room-list" class="space-y-3">
                        <!-- Rooms will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- My Bookings Page -->
        <div id="mybookings-page" class="page hidden">
            <div class="bg-white rounded-2xl p-6 card-shadow">
                <h2 class="text-2xl font-semibold text-teal-800 mb-4">üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h2>
                
                <!-- Filters -->
                <div class="grid md:grid-cols-2 gap-4 mb-6">
                    <div>
                        <label class="block text-sm font-medium text-teal-700 mb-1">‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏´‡πâ‡∏≠‡∏á</label>
                        <select id="filter-room" onchange="filterBookings()" class="w-full p-2 border-2 border-teal-200 rounded-lg focus:border-teal-500 focus:outline-none">
                            <option value="">‡∏ó‡∏∏‡∏Å‡∏´‡πâ‡∏≠‡∏á</option>
                            <option value="‡∏´‡πâ‡∏≠‡∏á‡πÑ‡∏û‡∏•‡∏¥‡∏ô">‡∏´‡πâ‡∏≠‡∏á‡πÑ‡∏û‡∏•‡∏¥‡∏ô</option>
                            <option value="‡∏´‡πâ‡∏≠‡∏á‡∏ß‡∏¥‡∏ö‡∏π‡∏•‡∏¢‡πå">‡∏´‡πâ‡∏≠‡∏á‡∏ß‡∏¥‡∏ö‡∏π‡∏•‡∏¢‡πå</option>
                            <option value="‡∏´‡πâ‡∏≠‡∏á‡∏Å‡∏£‡∏£‡∏ì‡∏¥‡∏Å‡∏≤‡∏£‡πå">‡∏´‡πâ‡∏≠‡∏á‡∏Å‡∏£‡∏£‡∏ì‡∏¥‡∏Å‡∏≤‡∏£‡πå</option>
                            <option value="‡∏´‡πâ‡∏≠‡∏á‡∏ß‡∏¥‡πÑ‡∏•‡∏ß‡∏£‡∏£‡∏ì">‡∏´‡πâ‡∏≠‡∏á‡∏ß‡∏¥‡πÑ‡∏•‡∏ß‡∏£‡∏£‡∏ì</option>
                            <option value="‡∏´‡πâ‡∏≠‡∏á‡∏≠‡∏¥‡∏ô‡∏ó‡∏ô‡∏¥‡∏•">‡∏´‡πâ‡∏≠‡∏á‡∏≠‡∏¥‡∏ô‡∏ó‡∏ô‡∏¥‡∏•</option>
                            <option value="‡∏´‡πâ‡∏≠‡∏á‡∏®‡∏£‡∏µ‡∏ß‡∏¥‡∏•‡∏±‡∏¢">‡∏´‡πâ‡∏≠‡∏á‡∏®‡∏£‡∏µ‡∏ß‡∏¥‡∏•‡∏±‡∏¢</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-teal-700 mb-1">‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                        <input type="date" id="filter-date" onchange="filterBookings()" class="w-full p-2 border-2 border-teal-200 rounded-lg focus:border-teal-500 focus:outline-none">
                    </div>
                </div>

                <div id="my-bookings-list" class="space-y-4">
                    <!-- Bookings will be populated here -->
                </div>
            </div>
        </div>

        <!-- Statistics Page -->
        <div id="statistics-page" class="page hidden">
            <div class="grid lg:grid-cols-2 gap-8">
                <div class="bg-white rounded-2xl p-6 card-shadow">
                    <h2 class="text-2xl font-semibold text-teal-800 mb-4">üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h2>
                    <div id="stats-content" class="space-y-4">
                        <!-- Statistics will be populated here -->
                    </div>
                </div>
                <div class="bg-white rounded-2xl p-6 card-shadow">
                    <h2 class="text-2xl font-semibold text-teal-800 mb-4">üìà ‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏¥‡∏¢‡∏°</h2>
                    <div id="popular-rooms" class="space-y-3">
                        <!-- Popular rooms will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Booking Modal -->
    <div id="booking-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 card-shadow">
            <h3 class="text-2xl font-semibold text-teal-800 mb-4">üìù ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</h3>
            <form id="booking-form" onsubmit="submitBooking(event)">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-teal-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á</label>
                        <input type="text" id="booker-name" required class="w-full p-3 border-2 border-teal-200 rounded-lg focus:border-teal-500 focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-teal-700 mb-1">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                        <input type="tel" id="booker-phone" required class="w-full p-3 border-2 border-teal-200 rounded-lg focus:border-teal-500 focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-teal-700 mb-1">‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</label>
                        <textarea id="booking-purpose" required class="w-full p-3 border-2 border-teal-200 rounded-lg focus:border-teal-500 focus:outline-none h-20"></textarea>
                    </div>
                    <div id="booking-summary" class="bg-teal-50 p-3 rounded-lg text-sm text-teal-800">
                        <!-- Booking summary will be shown here -->
                    </div>
                </div>
                <div class="flex gap-3 mt-6">
                    <button type="button" onclick="closeBookingModal()" class="flex-1 py-3 border-2 border-teal-300 text-teal-700 rounded-lg font-medium hover:bg-teal-50">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button type="submit" class="flex-1 btn-primary text-white py-3 rounded-lg font-medium hover:shadow-lg transition-all">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-30 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 text-center">
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-teal-600 mx-auto mb-3"></div>
            <p class="text-teal-800">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
        </div>
    </div>

    <script>
        // Online Database Configuration
        // ‡πÉ‡∏ä‡πâ Firebase Realtime Database (‡∏ü‡∏£‡∏µ)
        const FIREBASE_URL = 'https://meetingdusit-default-rtdb.asia-southeast1.firebasedatabase.app/bookings.json';
        
        // Data storage
        let bookings = [];
        
        const rooms = [
            { name: '‡∏´‡πâ‡∏≠‡∏á‡πÑ‡∏û‡∏•‡∏¥‡∏ô', capacity: 20, icon: 'üíé' },
            { name: '‡∏´‡πâ‡∏≠‡∏á‡∏ß‡∏¥‡∏ö‡∏π‡∏•‡∏¢‡πå', capacity: 20, icon: 'üåü' },
            { name: '‡∏´‡πâ‡∏≠‡∏á‡∏Å‡∏£‡∏£‡∏ì‡∏¥‡∏Å‡∏≤‡∏£‡πå', capacity: 10, icon: 'üå∏' },
            { name: '‡∏´‡πâ‡∏≠‡∏á‡∏ß‡∏¥‡πÑ‡∏•‡∏ß‡∏£‡∏£‡∏ì', capacity: 10, icon: 'üå∫' },
            { name: '‡∏´‡πâ‡∏≠‡∏á‡∏≠‡∏¥‡∏ô‡∏ó‡∏ô‡∏¥‡∏•', capacity: 6, icon: 'üíô' },
            { name: '‡∏´‡πâ‡∏≠‡∏á‡∏®‡∏£‡∏µ‡∏ß‡∏¥‡∏•‡∏±‡∏¢', capacity: 6, icon: 'üåø' }
        ];

        let selectedRoom = null;

        // Online Database Functions
        async function loadBookingsFromOnline() {
            try {
                showLoading(true);
                updateConnectionStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...', 'orange');
                
                const response = await fetch(FIREBASE_URL);
                
                if (response.ok) {
                    const data = await response.json();
                    bookings = data ? Object.values(data) : [];
                    updateConnectionStatus('‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'green');
                } else {
                    throw new Error('Failed to fetch data');
                }
                
            } catch (error) {
                console.error('Error loading bookings:', error);
                updateConnectionStatus('‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß - ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á', 'red');
                bookings = JSON.parse(localStorage.getItem('meetingRoomBookings')) || [];
            } finally {
                showLoading(false);
            }
        }

        async function saveBookingsToOnline() {
            try {
                updateConnectionStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...', 'orange');
                
                // ‡πÅ‡∏õ‡∏•‡∏á array ‡πÄ‡∏õ‡πá‡∏ô object ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Firebase
                const bookingsObject = {};
                bookings.forEach(booking => {
                    bookingsObject[booking.id] = booking;
                });
                
                const response = await fetch(FIREBASE_URL, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(bookingsObject)
                });
                
                if (response.ok) {
                    updateConnectionStatus('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'green');
                    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á localStorage ‡πÄ‡∏õ‡πá‡∏ô backup
                    localStorage.setItem('meetingRoomBookings', JSON.stringify(bookings));
                } else {
                    throw new Error('Failed to save to Firebase');
                }
                
            } catch (error) {
                console.error('Error saving bookings:', error);
                updateConnectionStatus('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á', 'red');
                // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á localStorage ‡πÄ‡∏õ‡πá‡∏ô fallback
                localStorage.setItem('meetingRoomBookings', JSON.stringify(bookings));
            }
        }

        function updateConnectionStatus(message, color) {
            const statusEl = document.getElementById('connection-status');
            const colors = {
                green: 'üü¢ ',
                orange: 'üü° ',
                red: 'üî¥ '
            };
            statusEl.innerHTML = `<span class="text-sm text-${color}-600">${colors[color]}${message}</span>`;
        }

        function showLoading(show) {
            const overlay = document.getElementById('loading-overlay');
            if (show) {
                overlay.classList.remove('hidden');
                overlay.classList.add('flex');
                document.body.classList.add('loading');
            } else {
                overlay.classList.add('hidden');
                overlay.classList.remove('flex');
                document.body.classList.remove('loading');
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', async function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('selected-date').value = today;
            document.getElementById('selected-date').min = today;
            
            updateEndTimeOptions();
            
            // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå
            await loadBookingsFromOnline();
            
            checkAvailability();
            updateMyBookings();
            updateStatistics();
            
            // Auto-refresh ‡∏ó‡∏∏‡∏Å 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
            setInterval(async () => {
                await loadBookingsFromOnline();
                checkAvailability();
                updateMyBookings();
                updateStatistics();
            }, 30000);
        });

        // Navigation
        function showPage(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
            document.getElementById(page + '-page').classList.remove('hidden');
            
            document.querySelectorAll('[id^="nav-"]').forEach(btn => {
                btn.className = 'px-6 py-2 rounded-full text-teal-700 hover:bg-teal-50 font-medium';
            });
            document.getElementById('nav-' + page).className = 'px-6 py-2 rounded-full btn-primary text-white font-medium';
            
            if (page === 'mybookings') updateMyBookings();
            if (page === 'statistics') updateStatistics();
        }

        // Time validation
        document.getElementById('start-time').addEventListener('change', updateEndTimeOptions);

        function updateEndTimeOptions() {
            const startTime = document.getElementById('start-time').value;
            const endTimeSelect = document.getElementById('end-time');
            const startHour = parseInt(startTime.split(':')[0]);
            
            endTimeSelect.innerHTML = '';
            
            for (let hour = startHour + 1; hour <= Math.min(startHour + 4, 18); hour++) {
                const timeStr = hour.toString().padStart(2, '0') + ':00';
                const option = document.createElement('option');
                option.value = timeStr;
                option.textContent = timeStr;
                endTimeSelect.appendChild(option);
            }
        }

        // Check room availability
        function checkAvailability() {
            const date = document.getElementById('selected-date').value;
            const startTime = document.getElementById('start-time').value;
            const endTime = document.getElementById('end-time').value;
            
            if (!date || !startTime || !endTime) return;
            
            const roomListDiv = document.getElementById('room-list');
            roomListDiv.innerHTML = '';
            
            rooms.forEach(room => {
                const isBooked = bookings.some(booking => 
                    booking.room === room.name && 
                    booking.date === date && 
                    timeOverlap(booking.startTime, booking.endTime, startTime, endTime)
                );
                
                const roomDiv = document.createElement('div');
                roomDiv.className = `p-4 border-2 rounded-lg cursor-pointer transition-all ${
                    isBooked ? 'border-red-200 bg-red-50' : 'border-teal-200 bg-teal-50 hover:border-teal-400 hover:shadow-md'
                }`;
                
                roomDiv.innerHTML = `
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="font-semibold text-teal-800">${room.icon} ${room.name}</h3>
                            <p class="text-sm text-teal-600">‡∏à‡∏∏‡πÑ‡∏î‡πâ ${room.capacity} ‡∏Ñ‡∏ô</p>
                        </div>
                        <div class="text-right">
                            <span class="text-sm font-medium ${isBooked ? 'text-red-600' : 'text-green-600'}">
                                ${isBooked ? '‚ùå ‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß' : '‚úÖ ‡∏ß‡πà‡∏≤‡∏á'}
                            </span>
                        </div>
                    </div>
                `;
                
                if (!isBooked) {
                    roomDiv.addEventListener('click', () => openBookingModal(room));
                }
                
                roomListDiv.appendChild(roomDiv);
            });
        }

        function timeOverlap(start1, end1, start2, end2) {
            return start1 < end2 && start2 < end1;
        }

        // Booking modal
        function openBookingModal(room) {
            selectedRoom = room;
            const date = document.getElementById('selected-date').value;
            const startTime = document.getElementById('start-time').value;
            const endTime = document.getElementById('end-time').value;
            
            document.getElementById('booking-summary').innerHTML = `
                <strong>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á:</strong><br>
                ‡∏´‡πâ‡∏≠‡∏á: ${room.name}<br>
                ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${new Date(date).toLocaleDateString('th-TH')}<br>
                ‡πÄ‡∏ß‡∏•‡∏≤: ${startTime} - ${endTime}
            `;
            
            document.getElementById('booking-modal').classList.remove('hidden');
            document.getElementById('booking-modal').classList.add('flex');
        }

        function closeBookingModal() {
            document.getElementById('booking-modal').classList.add('hidden');
            document.getElementById('booking-modal').classList.remove('flex');
            document.getElementById('booking-form').reset();
        }

        async function submitBooking(event) {
            event.preventDefault();
            
            const booking = {
                id: Date.now(),
                room: selectedRoom.name,
                date: document.getElementById('selected-date').value,
                startTime: document.getElementById('start-time').value,
                endTime: document.getElementById('end-time').value,
                bookerName: document.getElementById('booker-name').value,
                bookerPhone: document.getElementById('booker-phone').value,
                purpose: document.getElementById('booking-purpose').value,
                timestamp: new Date().toISOString()
            };
            
            bookings.push(booking);
            
            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏õ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå
            await saveBookingsToOnline();
            
            closeBookingModal();
            checkAvailability();
            
            alert('‚úÖ ‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!');
        }

        // My bookings
        function updateMyBookings() {
            const myBookingsList = document.getElementById('my-bookings-list');
            const filteredBookings = getFilteredBookings();
            
            if (filteredBookings.length === 0) {
                myBookingsList.innerHTML = '<p class="text-center text-teal-600 py-8">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</p>';
                return;
            }
            
            myBookingsList.innerHTML = filteredBookings.map(booking => `
                <div class="border-2 border-teal-200 rounded-lg p-4 bg-teal-50">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h3 class="font-semibold text-teal-800">${booking.room}</h3>
                            <p class="text-sm text-teal-600">‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á: ${booking.bookerName}</p>
                            <p class="text-sm text-teal-600">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${new Date(booking.date).toLocaleDateString('th-TH')}</p>
                            <p class="text-sm text-teal-600">‡πÄ‡∏ß‡∏•‡∏≤: ${booking.startTime} - ${booking.endTime}</p>
                            <p class="text-sm text-teal-600">‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå: ${booking.purpose}</p>
                        </div>
                        <button onclick="cancelBooking(${booking.id})" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                            ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function getFilteredBookings() {
            const roomFilter = document.getElementById('filter-room').value;
            const dateFilter = document.getElementById('filter-date').value;
            
            return bookings.filter(booking => {
                const roomMatch = !roomFilter || booking.room === roomFilter;
                const dateMatch = !dateFilter || booking.date === dateFilter;
                return roomMatch && dateMatch;
            });
        }

        function filterBookings() {
            updateMyBookings();
        }

        async function cancelBooking(bookingId) {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                bookings = bookings.filter(booking => booking.id !== bookingId);
                
                // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏õ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå
                await saveBookingsToOnline();
                
                updateMyBookings();
                checkAvailability();
                updateStatistics();
                alert('‚úÖ ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!');
            }
        }

        // Statistics
        function updateStatistics() {
            const statsContent = document.getElementById('stats-content');
            const popularRooms = document.getElementById('popular-rooms');
            
            // Total bookings
            const totalBookings = bookings.length;
            
            // Room usage count
            const roomUsage = {};
            rooms.forEach(room => roomUsage[room.name] = 0);
            bookings.forEach(booking => roomUsage[booking.room]++);
            
            // Most popular time slots
            const timeSlots = {};
            bookings.forEach(booking => {
                const slot = `${booking.startTime}-${booking.endTime}`;
                timeSlots[slot] = (timeSlots[slot] || 0) + 1;
            });
            
            const mostPopularTime = Object.keys(timeSlots).reduce((a, b) => 
                timeSlots[a] > timeSlots[b] ? a : b, Object.keys(timeSlots)[0] || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'
            );
            
            statsContent.innerHTML = `
                <div class="bg-teal-50 p-4 rounded-lg">
                    <h4 class="font-semibold text-teal-800">üìä ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h4>
                    <p class="text-2xl font-bold text-teal-600">${totalBookings} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
                </div>
                <div class="bg-blue-50 p-4 rounded-lg">
                    <h4 class="font-semibold text-blue-800">‚è∞ ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏¥‡∏¢‡∏°</h4>
                    <p class="text-lg font-medium text-blue-600">${mostPopularTime}</p>
                </div>
                <div class="bg-green-50 p-4 rounded-lg">
                    <h4 class="font-semibold text-green-800">üåê ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏∞‡∏ö‡∏ö</h4>
                    <p class="text-sm text-green-600">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå</p>
                </div>
            `;
            
            // Popular rooms chart
            const sortedRooms = Object.entries(roomUsage)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 6);
            
            popularRooms.innerHTML = sortedRooms.map(([roomName, count], index) => {
                const room = rooms.find(r => r.name === roomName);
                const percentage = totalBookings > 0 ? (count / totalBookings * 100).toFixed(1) : 0;
                return `
                    <div class="flex items-center justify-between p-3 bg-gradient-to-r from-teal-50 to-blue-50 rounded-lg">
                        <div class="flex items-center">
                            <span class="text-2xl mr-3">${room?.icon || 'üèõÔ∏è'}</span>
                            <div>
                                <h4 class="font-medium text-teal-800">${roomName}</h4>
                                <p class="text-sm text-teal-600">${count} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á (${percentage}%)</p>
                            </div>
                        </div>
                        <div class="w-16 bg-teal-200 rounded-full h-2">
                            <div class="bg-teal-500 h-2 rounded-full" style="width: ${percentage}%"></div>
                        </div>
                    </div>
                `;
            }).join('');
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98176e27303675d8',t:'MTc1ODI2NzU3Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
